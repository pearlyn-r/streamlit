def extract_mapping_from_sheet(workbook, sheet_name='mapping'):
    try:
        ws = workbook[sheet_name]
        mapping = {}
        for row in ws.iter_rows(min_row=2, values_only=True):  # skip header
            key, comment = row[:2]
            if key:
                mapping[str(key).strip()] = str(comment).strip() if comment else ""
        print(f"Loaded {len(mapping)} mapping entries.")
        return mapping
    except Exception as e:
        print(f"Failed to extract mapping: {e}")
        return {}

def apply_mapping_to_pivot(workbook, pivot_sheet='Sheet2', mapping=None):
    try:
        ws = workbook[pivot_sheet]
        for row in range(2, ws.max_row + 1):
            key = ws.cell(row=row, column=1).value  # Column A
            if key is not None and mapping:
                mapped_comment = mapping.get(str(key).strip(), "")
                ws.cell(row=row, column=5, value=mapped_comment)  # Column E
    except Exception as e:
        print(f"Error applying mapping to pivot: {e}")
