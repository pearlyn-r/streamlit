def apply_mapping_to_pivot(workbook, pivot_sheet='Sheet2', mapping=None):
    try:
        if not mapping:
            print("❗No mapping dictionary provided.")
            return

        ws = workbook[pivot_sheet]
        mapped_count = 0
        fallback_count = 0

        for row in range(5, ws.max_row + 1):
            raw_key = ws.cell(row=row, column=1).value  # Column A
            if raw_key is None:
                continue

            cleaned_key = str(raw_key).strip()
            if cleaned_key in mapping:
                comment = mapping[cleaned_key]
                source = "✔️ Mapped"
                mapped_count += 1
            else:
                comment = "Under investigation for now — reason not determined"
                source = "❗Fallback"
                fallback_count += 1

            ws.cell(row=row, column=5, value=comment)  # Column E

            print(f"Row {row}: {cleaned_key} → {comment} ({source}) → written to E{row}")

        print(f"\n✅ Mapping complete. {mapped_count} mapped, {fallback_count} fallback.")
    except Exception as e:
        print(f"❌ Error in apply_mapping_to_pivot: {e}")
